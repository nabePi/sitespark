generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserTier {
  free
  basic
  pro
  enterprise
}

enum WebsiteStatus {
  draft
  generating
  published
  archived
}

enum TokenTransactionType {
  signup_bonus
  daily_login
  purchase
  website_generation
  content_generation
  design_generation
  refund
}

enum BlogPostStatus {
  draft
  published
  archived
}

model User {
  id                String             @id @default(uuid())
  email             String             @unique
  password          String
  name              String?
  tokensBalance     Int                @default(0) @map("tokens_balance")
  tier              UserTier           @default(free)
  lastLoginAt       DateTime?          @map("last_login_at")
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")

  websites          Website[]
  tokenTransactions TokenTransaction[]

  @@map("users")
}

model Website {
  id            String        @id @default(uuid())
  userId        String        @map("user_id")
  subdomain     String        @unique
  name          String
  description   String?
  config        Json?         @default("{}")
  status        WebsiteStatus @default(draft)
  aiModel       String?       @map("ai_model")
  generatedHtml String?       @map("generated_html") @db.Text
  generatedCss  String?       @map("generated_css") @db.Text
  publishedAt   DateTime?     @map("published_at")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  blogPosts     BlogPost[]
  formSubmissions FormSubmission[]

  @@map("websites")
}

model TokenTransaction {
  id          String               @id @default(uuid())
  userId      String               @map("user_id")
  amount      Int
  type        TokenTransactionType
  description String?
  metadata    Json?                @default("{}")
  createdAt   DateTime             @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@map("token_transactions")
}

model BlogPost {
  id        String         @id @default(uuid())
  websiteId String         @map("website_id")
  title     String
  slug      String
  content   String         @db.Text
  excerpt   String?
  coverImage String?       @map("cover_image")
  status    BlogPostStatus @default(draft)
  publishedAt DateTime?    @map("published_at")
  createdAt DateTime       @default(now()) @map("created_at")
  updatedAt DateTime       @updatedAt @map("updated_at")

  website Website @relation(fields: [websiteId], references: [id], onDelete: Cascade)

  @@unique([websiteId, slug])
  @@index([websiteId])
  @@index([status])
  @@map("blog_posts")
}

model FormSubmission {
  id        String   @id @default(uuid())
  websiteId String   @map("website_id")
  formName  String   @default("contact") @map("form_name")
  data      Json
  ipAddress String?  @map("ip_address")
  createdAt DateTime @default(now()) @map("created_at")

  website Website @relation(fields: [websiteId], references: [id], onDelete: Cascade)

  @@index([websiteId])
  @@index([createdAt])
  @@map("form_submissions")
}